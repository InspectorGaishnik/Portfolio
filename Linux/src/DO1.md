# Операционные системы UNIX/Linux (Базовый)

Установка и обновления системы Linux. Основы администрирования.

## Part 1. Установка ОС

**== Задание ==**

##### Установка **Ubuntu 20.04 Server LTS** без графического интерфейса. (Используется программа для виртуализации — VirtualBox)

![1751639635372](image/DO1/1751639635372.png)

## Part 2. Создание пользователя

**== Задание ==**

##### Создание пользователя, отличного от созданного при установке. Пользователь устанавливается в группу `adm`.

Выполнение команды: sudo adduser dkaal2

- ![1751639457386](image/DO1/1751639457386.png)

## Part 3. Настройка сети ОС

**== Задание ==**

##### Задача названия машины вида user-1.

Выполнение команды: sudo hostnamectl set-hostname dkaalinkov

![1751640146404](image/DO1/1751640146404.png)

##### Установка временной зоны, соответствующей твоему текущему местоположению.

Выполнение команды: sudo timedatectl set-timezone Europe/Moscow

![1751640484656](image/DO1/1751640484656.png)

##### Вывод названия сетевых интерфейсов с помощью консольной команды.

![1751641911177](image/DO1/1751641911177.png)

- Объяснение наличия интерфейса lo.

  ![1751642371669](image/DO1/1751642371669.png)

##### Получение ip адреса устройства от DHCP-сервера, на котором мы работаем.

Выполнение команды: ip a

![1751642942293](image/DO1/1751642942293.png)

- Расшифровка DHCP.
- **DHCP** – это сетевой протокол, который автоматически назначает IP-адреса и другие параметры сети устройствам.
  ![1751643187169](image/DO1/1751643187169.png)
  ![1751643261227](image/DO1/1751643261227.png)

##### Определение и вывод на экран внешнего ip-адрес шлюза (ip) и внутреннего IP-адрес шлюза, он же ip-адрес по умолчанию (gw).

Внутренний IP-адрес шлюза (gw):

![1751644745591](image/DO1/1751644745591.png)

Внешний (публичный) IP-адрес шлюза:

![1751645006987](image/DO1/1751645006987.png)

##### Задача статичных (заданные вручную, а не полученные от DHCP-сервера) настроек ip, gw, dns (используем публичные DNS-серверы, например 1.1.1.1 или 8.8.8.8).

Задача статичных ip адресов: /etc/netplan/...

![1751719144450](image/DO1/1751719144450.png)

##### Перезагрузка виртуальной машины. Убедиться, что статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем пункте.

Выполнение команды: ping -c 5 1.1.1.1, ping -c 5 ya.ru

![1751720396805](image/DO1/1751720396805.png)

## Part 4. Обновление ОС

**== Задание ==**

##### Обновление системных пакетов до последней версии на момент выполнения задания версии.

Выполнение команды: sudo apt upgrade:

![1751721694204](image/DO1/1751721694204.png)

## Part 5. Использование команды **sudo**

**== Задание ==**

##### Даем разрешение пользователю, созданному в [Part 2](#part-2-создание-пользователя),выполнять команду sudo.

![1751728109020](image/DO1/1751728109020.png)

![1751730872190](image/DO1/1751730872190.png)

![1751729947908](image/DO1/1751729947908.png)

## Part 6. Установка и настройка службы времени

**== Задание ==**

##### Настраиваем службу автоматической синхронизации времени.

![1751735403870](image/DO1/1751735403870.png)

![1751735603028](image/DO1/1751735603028.png)

Используемые команды в ходе выполнения данного пункта:

![1751735481564](image/DO1/1751735481564.png)

## Part 7. Установка и использование текстовых редакторов

**== Задание ==**

##### Установи текстовые редакторы **VIM** (+ любые два по желанию **NANO**, **MCEDIT**, **JOE** и т. д.)

Установил следующие текстовые редакторы: Vim, Mcedit, Joe.

##### Используя каждый из трех выбранных редакторов, создай файл *test_X.txt*, где X — название редактора, в котором создан файл. Напиши в нём свой никнейм, закрой файл с сохранением изменений.

Vim:

Для выхода с сохранением изменений использовал команду - :wq

![1751807632560](image/DO1/1751807632560.png)

Mcedit:

Для выхода с сохранением изменений использовал клашиву F10, затем с помощью кнопки - YES подтвердил сохранение изменений.

![1751807916352](image/DO1/1751807916352.png)

Joe:

Для выхода с сохранением изменений использовал комбирнацию клавишь - **Ctrl + K + X**

![1751808433996](image/DO1/1751808433996.png)

##### Используя каждый из трех выбранных редакторов, открой файл на редактирование, отредактируй файл, заменив никнейм на строку «Project», закрой файл без сохранения изменений.

Vim:

Для выхода из файла без сохранения изменений использовал команду - :q!

![1752768635636](image/DO1/1752768635636.jpg)

Mcedit:

Для выхода из файла без сохранения изменений использовал клашиву F10, затем с помощью кнопки - NO подтвердил выход без сохранения изменений.

![1752769436297](image/DO1/1752769436297.jpg)

##### Используя каждый из трех выбранных редакторов, отредактируй файл ещё раз (по аналогии с предыдущим пунктом), а затем освой функции поиска по содержимому файла (слово) и замены слова на любое другое.

Поиск слов и их замена через ubuntu:

![1752769621049](image/DO1/1752769621049.jpg)

vim:

Поиск слова:

![1752769931833](image/DO1/1752769931833.jpg)

Замена слова:

![1752770219412](image/DO1/1752770219412.jpg)

Mcedit:

![1752770547401](image/DO1/1752770547401.jpg)

![1752770667809](image/DO1/1752770667809.jpg)

## Part 8. Установка и базовая настройка сервиса **SSHD**

**== Задание ==**

##### Установи службу SSHd.

![1751823412670](image/DO1/1751823412670.png)

##### Добавь автостарт службы при загрузке системы.

![1751823855070](image/DO1/1751823855070.png)

##### Перенастрой службу SSHd на порт 2022.

Заменили строку Port 22 на Port 2022:

![1751824562150](image/DO1/1751824562150.png)

Разрешаем порт 2022 в брандмауэре (UFW), если используется ufw:

![1751890587302](image/DO1/1751890587302.png)

Проверяем правила:

![1751890693127](image/DO1/1751890693127.png)

Добавляем правило:

sudo iptables -A INPUT -p tcp --dport 2022 -j ACCEPT

Устанавливаем iptables-persistent:

sudo apt update
sudo apt install iptables-persistent

Перезапускаем SSH-сервер и проверяем статус:

![1751891427834](image/DO1/1751891427834.png)

Проверяем работу SSH на новом порту локально:

ssh username@localhost -p 2022:

![1751891643475](image/DO1/1751891643475.png)

Отключаем старый порт 22:

![1751891912658](image/DO1/1751891912658.png)

##### Используя команду ps, покажи наличие процесса sshd. Для этого к команде нужно подобрать ключи.

Поиск по имени процесса:

![1751889305934](image/DO1/1751889305934.png)

Точный поиск по имени бинарного файла:

![1751889311666](image/DO1/1751889311666.png)

Просмотр процессов с деревом зависимостей:

![1751889762408](image/DO1/1751889762408.png)

Проверка через grep, если нужно только проверить, запущен ли sshd, без деталей

![1751889874044](image/DO1/1751889874044.png)

- Объяснение значения команды и каждого ключа в ней:

  ![1751901290517](image/DO1/1751901290517.png)

  ![1751901342191](image/DO1/1751901342191.png)

  ![1751901395669](image/DO1/1751901395669.png)

  ![1751901479862](image/DO1/1751901479862.png)

  ![1751901537886](image/DO1/1751901537886.png)

##### Перезагрузи систему.

![1751892145882](image/DO1/1751892145882.png)

- В отчёте объясни значение ключей -tan, значение каждого столбца вывода, значение 0.0.0.0.
  Значения каждого из ключей -tan:
  t (--tcp) - Показывает только TCP-соединения (исключая UPD, RAW и другие)
  a(--all) - Показывает все соединения (включая слушающие сокеты и активные подключения)
  n(--numeric) - Отключает преобразование адресов и портов в имена:

  IP-адреса показываются численно (вместо имен хостов)

  Номера портов показываются цифрами (вместо сервисов, например 22 вместо ssh)

  Значение каждого столбца вывода:

  ![1751898590963](image/DO1/1751898590963.png)

  ![1751898620529](image/DO1/1751898620529.png)

  ![1751898705138](image/DO1/1751898705138.png)

  ![1751898708991](image/DO1/1751898708991.png)

  ![1751898734924](image/DO1/1751898734924.png)

  ![1751898765249](image/DO1/1751898765249.png)

  Значение 0.0.0.0:

  ![1751899443239](image/DO1/1751899443239.png)

  ![1751899488400](image/DO1/1751899488400.png)

## Part 9. Установка и использование утилит **top**, **htop**

`-` Если бы меня спросили, что полезного делают утилиты **top** и **htop**, я бы ответил одним словом — всё.

**== Задание ==**

##### Установи и запусти утилиты top и htop.

top:

сортировка по умолчанию:

![1751904496140](image/DO1/1751904496140.png)

- По выводу команды top определи и напиши в отчёте:

  - uptime (время работы системы) - 3:57 ,
  - количество авторизованных пользователей - 3,
  - среднюю загрузку системы (load average) - 0.00, 0.00, 0.00,
  - общее количество процессов - 114(всего), 1(выпоолняются), 112(спят), 1(stopped), 0(зомби-процессы (если есть — проблема!)),
  - загрузку cpu - 0.0 us(загрузка пользовательскими процессами), 0.3 sy(загрузка ядром), 98.7 id(**простой CPU (idle)** , т.е. свободно **98.7%**), Общая загрузка CPU = `100% - idle` = `100 - 98.7 = 1.3%`,
  - загрузку памяти (RAM) - 1971.6 total(всего оперативной памяти), 902.6 free(свободно), 250.1 used(используется), `buff/cache` — память, используемая кешем (может быть освобождена при необходимости), `Swap` — использование файла подкачки,
  - pid процесса занимающего больше всего памяти - 3238, нажмите **`Shift + M`** (сортировка по памяти), верхний процесс в списке (`RES` или `%MEM` максимален) — самый "прожорливый", его PID указан в первом столбце,

    ![1751905618173](image/DO1/1751905618173.png)
  - pid процесса, занимающего больше всего процессорного времени (CPU) - 737по умолчанию `top` сортирует процессы по **%CPU**, Верхний процесс в списке — самый нагруженный.

    htop:
    сортировка по умолчанию:

    ![1751906085074](image/DO1/1751906085074.png)
- В отчёте представлены скрины с выводом команды htop:

  - отсортированному по

    PID:

  ![1751906470428](image/DO1/1751906470428.png)
  PERCENT_CPU:

  ![1751906482991](image/DO1/1751906482991.png)

  PERCENT_MEM:

  ![1751906521954](image/DO1/1751906521954.png)

  TIME:

  ![1751906746373](image/DO1/1751906746373.png)

  - отфильтрованному для процесса sshd:

    ![1751907160467](image/DO1/1751907160467.png)
  - с процессом syslog, найденным, используя поиск:

    Необходимо нажимать **`F3`** повторно, чтобы перейти к следующим совпадениям

    ![1751907761840](image/DO1/1751907761840.png)
  - с добавленным выводом hostname, clock и uptime:

    ![1751911092703](image/DO1/1751911092703.png)

## Part 10. Использование утилиты **fdisk**

**== Задание ==**

##### Запусти команду fdisk -l.

![1751914057432](image/DO1/1751914057432.png)

- В отчёте напиши название жесткого диска - /dev/sda,
- его размер - 26843545600 bytes,
- количество секторов - 52428800 sectors,
- также размер swap - 2.0 Gi

  ![1751914497954](image/DO1/1751914497954.png)

## Part 11. Использование утилиты **df**

**== Задание ==**

##### Запусти команду df.

- В отчёте напиши для корневого раздела (/):
  - размер раздела - 12G (11758760 КБ),
  - размер занятого пространства - 5.7G (5878336 КБ),
  - размер свободного пространства - 5.1G (5261316 КБ),
  - процент использования - 53%.

    ![1751915267296](image/DO1/1751915267296.png)
- Единица измерения в выводе - КБ.

##### Запусти команду df -Th.

- В отчёте напиши для корневого раздела (/):
  - размер раздела - 12G,
  - размер занятого пространства - 5.7G,
  - размер свободного пространства - 5.1G,
  - процент использования - 53%.

    ![1751982489339](image/DO1/1751982489339.png)
- Тип файловой системы - ext4.

## Part 12. Использование утилиты **du**

**== Задание ==**

##### Запусти команду du.

##### Выведи размер папок /home, /var, /var/log (в байтах, в человекочитаемом виде).

![1751983367862](image/DO1/1751983367862.png)

##### Выведи размер всего содержимого в /var/log (не общее, а каждого вложенного элемента, используя *).

![1751983435936](image/DO1/1751983435936.png)

## Part 13. Установка и использование утилиты **ncdu**

**== Задание ==**

##### Установи утилиту ncdu.

##### Выведи размер папок /home, /var, /var/log.

/home:

![1751991503756](image/DO1/1751991503756.png)

![1751991535382](image/DO1/1751991535382.png)

/var:

![1751992194603](image/DO1/1751992194603.png)

/var/log:

![1751992256640](image/DO1/1751992256640.png)

- Почему размеры через du и ncdu могут отличаться:

`du` обычно показывает  **больший размер** , потому что учитывает  **реальное выделенное место на диске** .

`ncdu` показывает  **логический размер файлов** , который может быть меньше.

## Part 14. Работа с системными журналами

**== Задание ==**

##### Открой для просмотра:

##### 1. /var/log/dmesg

##### 2. /var/log/syslog

##### 3. /var/log/auth.log

![1751994208229](image/DO1/1751994208229.png)

- Время последней успешной авторизации: Jul 8, 20:00:55,
- Имя пользователя и метод входа в систему: dkaal2, локальный вход(**консоль / TTY**)
- Рестарт службы SShd:
  ![1751994910471](image/DO1/1751994910471.png)

## Part 15. Использование планировщика заданий **CRON**

**== Задание ==**

##### Используя планировщик заданий, запусти команду uptime через каждые 2 минуты.

![1751999763230](image/DO1/1751999763230.png)

![1751999826260](image/DO1/1751999826260.png)

- Выведи на экран список текущих заданий для CRON.

  ![1751999550834](image/DO1/1751999550834.png)

##### Удали все задания из планировщика заданий.

![1751996842514](image/DO1/1751996842514.png)
