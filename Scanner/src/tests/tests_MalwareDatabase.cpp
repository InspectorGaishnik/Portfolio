#include <gtest/gtest.h>

#include "../MalwareScanner.cpp"

TEST(MalwareDatabaseTest, LoadAndCheck_My_Doom) {
    MalwareDatabase db;
    ASSERT_TRUE(db.loadFromCSV("../malicious_hashe.csv"));
    std::string verdict;
    EXPECT_TRUE(db.isMalicious("d88cf4ebda47388279a0a2c45442452c", verdict));
    EXPECT_EQ(verdict, "My Doom");
    EXPECT_FALSE(db.isMalicious("nonexistinghash", verdict));
}

TEST(MalwareDatabaseTest, LoadAndCheck_Conficker) {
    MalwareDatabase db;
    ASSERT_TRUE(db.loadFromCSV("../malicious_hashe.csv"));
    std::string verdict;
    EXPECT_TRUE(db.isMalicious("50b01599ede4e93c16045f8b2abab5c3", verdict));
    EXPECT_EQ(verdict, "Conficker");
    EXPECT_FALSE(db.isMalicious("nonexistinghash", verdict));
}

TEST(MalwareDatabaseTest, LoadAndCheck_CoolWebSearch) {
    MalwareDatabase db;
    ASSERT_TRUE(db.loadFromCSV("../malicious_hashe.csv"));
    std::string verdict;
    EXPECT_TRUE(db.isMalicious("22293e48c9872aa12165c18b6eadacce", verdict));
    EXPECT_EQ(verdict, "CoolWebSearch");
    EXPECT_FALSE(db.isMalicious("nonexistinghash", verdict));
}

TEST(MalwareDatabaseTest, LoadAndCheck_Gator) {
    MalwareDatabase db;
    ASSERT_TRUE(db.loadFromCSV("../malicious_hashe.csv"));
    std::string verdict;
    EXPECT_TRUE(db.isMalicious("cb5415ba0348bb81d3749d02c8def6c9", verdict));
    EXPECT_EQ(verdict, "Gator");
    EXPECT_FALSE(db.isMalicious("nonexistinghash", verdict));
}

TEST(MalwareDatabaseTest, LoadAndCheck) {
    MalwareDatabase db;
    ASSERT_TRUE(db.loadFromCSV("../malicious_hashe.csv"));
    std::string verdict;
    EXPECT_TRUE(db.isMalicious("98dd15c330fb5abb4508347265a7f76c", verdict));
    EXPECT_EQ(verdict, "Zeus");
    EXPECT_FALSE(db.isMalicious("nonexistinghash", verdict));
}

TEST(MalwareDatabaseTest, LoadAndCheck_Trojan_Spy_Win32_Noon) {
    MalwareDatabase db;
    ASSERT_TRUE(db.loadFromCSV("../malicious_hashe.csv"));
    std::string verdict;
    EXPECT_TRUE(db.isMalicious("c8d6a331d7e07e4e0b314e5fdad7b3c3", verdict));
    EXPECT_EQ(verdict, "Trojan-Spy.Win32.Noon");
    EXPECT_FALSE(db.isMalicious("nonexistinghash", verdict));
}

TEST(MalwareDatabaseTest, LoadAndCheck_SQL_Slammer) {
    MalwareDatabase db;
    ASSERT_TRUE(db.loadFromCSV("../malicious_hashe.csv"));
    std::string verdict;
    EXPECT_TRUE(db.isMalicious("2d106d2d8f9f03b07cfca22628302f6c", verdict));
    EXPECT_EQ(verdict, "SQL Slammer");
    EXPECT_FALSE(db.isMalicious("nonexistinghash", verdict));
}

TEST(MalwareDatabaseTest, LoadAndCheck_WannaCry) {
    MalwareDatabase db;
    ASSERT_TRUE(db.loadFromCSV("../malicious_hashe.csv"));
    std::string verdict;
    EXPECT_TRUE(db.isMalicious("424a38b21b4ecc0f8cf7f178012ed965", verdict));
    EXPECT_EQ(verdict, "WannaCry");
    EXPECT_FALSE(db.isMalicious("nonexistinghash", verdict));
}

TEST(MalwareDatabaseTest, LoadAndCheck_Locky) {
    MalwareDatabase db;
    ASSERT_TRUE(db.loadFromCSV("../malicious_hashe.csv"));
    std::string verdict;
    EXPECT_TRUE(db.isMalicious("979d3ab6ac0c156ebfb33e9f4d62347c", verdict));
    EXPECT_EQ(verdict, "Locky");
    EXPECT_FALSE(db.isMalicious("nonexistinghash", verdict));
}

